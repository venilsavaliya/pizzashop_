@{
    ViewBag.active = "Dashboard";
}

<div class="d-flex justify-content-between w-100">
    <h3 class="custom-blue fw-bold m-2">Dashboard</h3>

    <div class="d-flex justify-content-between m-2" style="width: 300px;">
        <div class="dropdown bg-white border-0 w-100">
            <a class="btn fw-semibold text-muted dropdown-toggle w-100 d-flex justify-content-between align-items-center"
                id="timeRangeBtn" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Today
            </a>

            <ul class="dropdown-menu w-100 " style="cursor: pointer;">
                <li><span class="dropdown-item bg-white" onclick="changeTimeRange('Today')">Today</span></li>
                <li><span class="dropdown-item bg-white" onclick="changeTimeRange('Last 7 days')">Last 7 days</span>
                </li>
                <li><span class="dropdown-item bg-white" onclick="changeTimeRange('Last 30 Days')">Last 30
                        days</span></li>
                <li><span class="dropdown-item bg-white" onclick="changeTimeRange('Current Month')">Current
                        Month</span></li>
                <li><span class="dropdown-item bg-white" onclick="changeTimeRange('Custom Date')">Custom
                        Date</span>
                </li>
            </ul>
        </div>
    </div>



</div>



<div id="dashboard_container">

</div>


<div class="modal fade" id="CustomeDateModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content w-100">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Select Date Range</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form id="customeDateForm" method="post">
                <div class="modal-body">
                    <div class="d-flex gap-2 flex-grow-1 justify-content-between">
                        <div class="form-floating flex-grow-1 " style="max-width: 340px;">
                            <input type="date" id="fromDate" class="form-control py-2 w-100">
                            <label for="fromDate">From Date</label>
                        </div>

                        <div class="form-floating flex-grow-1" style="max-width: 340px;">
                            <input type="date" id="toDate" class="form-control py-2 w-100">
                            <label for="toDate">To Date</label>
                        </div>
                    </div>

                </div>
                <div class="d-flex justify-content-center gap-2 p-2 mb-2">
                    <button type="submit" class="btn custom-btn-bg text-white fw-medium">Submit</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>

            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

    $(document).ready(function () {
        changeTimeRange("Last 7 days");

        $("#customeDateForm").submit(function (e) {
            e.preventDefault();


            if ($("#fromDate").val() == "" || $("#toDate").val() == "") {
                toastr.warning("Please select valid date");
                return;
            }
            $.ajax({
            type: "Get",
            url: "/Admin/GetDashboardData",
            data: {
                startdate: $("#fromDate").val(),
                enddate: $("#toDate").val()
            },
            success: function (response) {
              

                $("#dashboard_container").html(response);
            }
        })
            var Modal = bootstrap.Modal.getInstance(
                document.getElementById("CustomeDateModal")
            );
            Modal.hide();

        });
    })

    function handleOpenDateModal() {
        var modal = new bootstrap.Modal(document.getElementById('CustomeDateModal'));
        modal.show();
    }

    function changeTimeRange(name) {
        $("#timeRangeBtn").text(name); // Update button text

        const today = new Date();
        let startdate = new Date();
        let enddate = new Date();

        if (name === "Today") {
            // Start and end are both today
        }
        else if (name === "Last 7 days") {
            startdate.setDate(today.getDate() - 6); // Including today
        }
        else if (name === "Last 30 Days") {
            startdate.setDate(today.getDate() - 29);
        }
        else if (name === "Current Month") {
            startdate = new Date(today.getFullYear(), today.getMonth(), 1);
        }
        else if (name === "Custom Date") {
            handleOpenDateModal();
            return;
        }

        // Format as yyyy-MM-dd
        const formatDate = (d) => d.toISOString().split('T')[0];
        const formattedStart = formatDate(startdate);
        const formattedEnd = formatDate(enddate);

        console.log("Start Date:", formattedStart);
        console.log("End Date:", formattedEnd);

        $.ajax({
            type: "Get",
            url: "/Admin/GetDashboardData",
            data: {
                startdate: formattedStart,
                enddate: formattedEnd
            },
            success: function (response) {
           

                $("#dashboard_container").html(response);
            }
        })

        // You can now send these dates to backend via AJAX or form
        // Example:
        // fetchData(formattedStart, formattedEnd);
    }


</script>
